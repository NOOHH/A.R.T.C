<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Registration System Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Admin Registration System Test</h1>
        
        <div class="alert alert-info">
            <h4>Testing JavaScript Functions</h4>
            <p>This page tests the core JavaScript functions for the admin registration system.</p>
        </div>
        
        <div class="row">
            <div class="col-12">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Program</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>John Doe</td>
                            <td>john.doe@example.com</td>
                            <td>Test Program</td>
                            <td><span class="badge bg-warning">Pending</span></td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-success" onclick="approveRegistration('123')">
                                        <i class="bi bi-check-circle"></i> Approve
                                    </button>
                                    <button type="button" class="btn btn-sm btn-info" onclick="viewRegistrationDetails('123')">
                                        <i class="bi bi-eye"></i> View
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" onclick="rejectRegistration('123')">
                                        <i class="bi bi-x-circle"></i> Reject
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Function Test Results</h3>
                <div id="test-results"></div>
            </div>
        </div>
    </div>

    <!-- Registration Details Modal -->
    <div class="modal fade" id="registrationModal" tabindex="-1" aria-labelledby="registrationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registrationModalLabel">Registration Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row" id="modal-details">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer" id="modal-actions">
                    <!-- Actions will be populated based on status -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Configuration
        const baseUrl = 'http://localhost:8000';
        const token = 'test-token'; // This would normally be the CSRF token
        
        // Global variables
        let registrationModal;
        
        // Helper functions
        function logTest(message, success = true) {
            const results = document.getElementById('test-results');
            const color = success ? 'success' : 'danger';
            const icon = success ? 'check-circle' : 'x-circle';
            results.innerHTML += `<div class="alert alert-${color}"><i class="bi bi-${icon}"></i> ${message}</div>`;
            console.log(message);
        }
        
        function na(value) {
            return value && value !== '' ? value : 'N/A';
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                return new Date(dateString).toLocaleDateString();
            } catch (e) {
                return 'Invalid Date';
            }
        }
        
        function getBadgeClass(status) {
            switch(status) {
                case 'approved': return 'bg-success';
                case 'rejected': return 'bg-danger';
                case 'pending':
                default: return 'bg-warning text-dark';
            }
        }
        
        function ucfirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function formatDocumentLink(filename, label) {
            if (!filename) return 'N/A';
            return `<a href="/storage/registrations/${filename}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="bi bi-file-earmark"></i> ${label}</a>`;
        }
        
        // Main functions - these are the ones being tested
        window.viewRegistrationDetails = function(registrationId) {
            logTest(`viewRegistrationDetails called with ID: ${registrationId}`);
            
            if (!registrationId) {
                alert('Invalid registration ID');
                logTest('ERROR: Invalid registration ID', false);
                return;
            }
            
            // Initialize modal if needed
            if (!registrationModal) {
                registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
            }
            
            const modalDetails = document.getElementById('modal-details');
            const modalActions = document.getElementById('modal-actions');
            
            modalDetails.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div><p>Loading registration details...</p></div>';
            registrationModal.show();
            
            // For testing, simulate a successful response
            setTimeout(() => {
                const mockData = {
                    firstname: 'John',
                    middlename: 'M.',
                    lastname: 'Doe',
                    email: 'john.doe@example.com',
                    contact_number: '123-456-7890',
                    emergency_contact_number: '098-765-4321',
                    gender: 'Male',
                    birthdate: '1990-01-01',
                    age: 34,
                    street_address: '123 Test Street',
                    city: 'Test City',
                    state_province: 'Test Province',
                    zipcode: '12345',
                    status: 'pending',
                    created_at: '2024-01-01',
                    program_title: 'Test Program',
                    package_name: 'Test Package',
                    plan_name: 'Test Plan',
                    enrollment_type: 'full',
                    learning_mode: 'online'
                };
                
                let leftColumn = `
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="bi bi-person"></i> Personal Information</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Full Name:</strong></div>
                                    <div class="col-sm-8">${na(mockData.firstname)} ${na(mockData.middlename)} ${na(mockData.lastname)}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Email:</strong></div>
                                    <div class="col-sm-8">${na(mockData.email)}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Phone:</strong></div>
                                    <div class="col-sm-8">${na(mockData.contact_number)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                let rightColumn = `
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="bi bi-mortarboard"></i> Program Details</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Program:</strong></div>
                                    <div class="col-sm-8">${na(mockData.program_title)}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Package:</strong></div>
                                    <div class="col-sm-8">${na(mockData.package_name)}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-sm-4"><strong>Status:</strong></div>
                                    <div class="col-sm-8">
                                        <span class="badge ${getBadgeClass(mockData.status)}">${ucfirst(mockData.status)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                modalDetails.innerHTML = leftColumn + rightColumn;
                modalActions.innerHTML = `
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success me-2" onclick="approveRegistration('${registrationId}')">
                        <i class="bi bi-check-circle"></i> Approve
                    </button>
                    <button type="button" class="btn btn-danger" onclick="rejectRegistration('${registrationId}')">
                        <i class="bi bi-x-circle"></i> Reject
                    </button>
                `;
                
                logTest('✅ Modal populated with test data successfully');
            }, 1000);
        };
        
        window.approveRegistration = function(registrationId) {
            logTest(`approveRegistration called with ID: ${registrationId}`);
            
            if (!registrationId) {
                alert('Invalid registration ID');
                logTest('ERROR: Invalid registration ID', false);
                return;
            }
            
            if (confirm('Are you sure you want to approve this registration?')) {
                logTest('✅ User confirmed approval');
                
                // For testing, just log the action
                logTest(`✅ Would send POST request to: ${baseUrl}/admin/registration/${registrationId}/approve`);
                logTest('✅ approveRegistration function completed successfully');
                
                // In real implementation, this would submit a form
                /*
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `${baseUrl}/admin/registration/${registrationId}/approve`;
                
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = '_token';
                csrfInput.value = token;
                
                form.appendChild(csrfInput);
                document.body.appendChild(form);
                form.submit();
                */
            } else {
                logTest('User cancelled approval');
            }
        };
        
        window.rejectRegistration = function(registrationId) {
            logTest(`rejectRegistration called with ID: ${registrationId}`);
            
            if (!registrationId) {
                alert('Invalid registration ID');
                logTest('ERROR: Invalid registration ID', false);
                return;
            }
            
            const reason = prompt('Please enter rejection reason:');
            if (reason) {
                logTest('✅ User provided rejection reason');
                logTest(`✅ Would send POST request to: ${baseUrl}/admin/registration/${registrationId}/reject`);
                logTest(`✅ Rejection reason: ${reason}`);
                logTest('✅ rejectRegistration function completed successfully');
                
                // In real implementation, this would submit a form with the reason
            } else {
                logTest('User cancelled rejection');
            }
        };
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            logTest('✅ DOM loaded, initializing modals...');
            
            // Initialize modals
            if (document.getElementById('registrationModal')) {
                registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
                logTest('✅ Registration modal initialized');
            } else {
                logTest('❌ Registration modal element not found', false);
            }
            
            // Test function availability
            logTest('🔍 Testing function availability...');
            
            if (typeof window.viewRegistrationDetails === 'function') {
                logTest('✅ viewRegistrationDetails function is available');
            } else {
                logTest('❌ viewRegistrationDetails function is NOT available', false);
            }
            
            if (typeof window.approveRegistration === 'function') {
                logTest('✅ approveRegistration function is available');
            } else {
                logTest('❌ approveRegistration function is NOT available', false);
            }
            
            if (typeof window.rejectRegistration === 'function') {
                logTest('✅ rejectRegistration function is available');
            } else {
                logTest('❌ rejectRegistration function is NOT available', false);
            }
            
            logTest('🎉 Test page initialization complete! Click the buttons above to test functionality.');
        });
    </script>
</body>
</html>
