<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .step {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .step.active {
            display: block;
        }
        
        .learning-mode-card {
            background: linear-gradient(145deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 15px;
            padding: 30px 20px;
            width: 250px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            text-align: center;
            color: white;
            margin: 10px;
            display: inline-block;
        }
        
        .learning-mode-card:hover {
            transform: translateY(-5px);
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        button.enabled {
            opacity: 1 !important;
            cursor: pointer !important;
        }
        
        .back-btn {
            background: #ccc;
        }
        
        .next-btn {
            background: linear-gradient(90deg,#a259c6,#6a82fb);
            color: white;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 1px solid #4caf50;
        }
    </style>
</head>
<body>
    <h1>Navigation and Button Highlighting Test</h1>
    
    <div class="status">
        <strong>Current Step: <span id="currentStepDisplay">1</span></strong><br>
        <strong>Learning Mode Selected: <span id="learningModeDisplay">None</span></strong><br>
        <strong>Next Button State: <span id="nextButtonState">Disabled</span></strong><br>
        <strong>Status: <span id="statusMessage">Ready to test</span></strong>
    </div>
    
    <!-- Step 1: Package Selection -->
    <div class="step active" id="step-1">
        <h2>Step 1: Package Selection</h2>
        
        <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
            <div class="package-card" onclick="selectPackage('1', 'Basic Package', '‚Ç±5,000')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; cursor: pointer; color: white; text-align: center; min-width: 200px;">
                <h3>Basic Package</h3>
                <p>‚Ç±5,000</p>
            </div>
            
            <div class="package-card" onclick="selectPackage('2', 'Premium Package', '‚Ç±8,000')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; cursor: pointer; color: white; text-align: center; min-width: 200px;">
                <h3>Premium Package</h3>
                <p>‚Ç±8,000</p>
            </div>
        </div>
        
        <div id="selectedPackageDisplay" style="display: none; margin: 20px 0; padding: 15px; background: #e8f5e8; border-radius: 8px; text-align: center;">
            <strong>Selected Package: <span id="selectedPackageName"></span></strong>
        </div>
        
        <input type="hidden" name="package_id" value="">
        
        <button onclick="nextStep()" id="packageNextBtn" disabled class="next-btn">Next to Learning Mode</button>
    </div>
    
    <!-- Step 2: Learning Mode Selection -->
    <div class="step" id="step-2">
        <h2>Step 2: Learning Mode Selection</h2>
        
        <div class="learning-mode-container">
            <div class="learning-mode-card" onclick="selectLearningMode('synchronous')" data-mode="synchronous">
                <div style="font-size: 3rem; margin-bottom: 15px;">üïê</div>
                <h4>Synchronous</h4>
                <p>Real-time classes with live interaction</p>
            </div>
            
            <div class="learning-mode-card" onclick="selectLearningMode('asynchronous')" data-mode="asynchronous">
                <div style="font-size: 3rem; margin-bottom: 15px;">üéØ</div>
                <h4>Asynchronous</h4>
                <p>Self-paced learning with recorded materials</p>
            </div>
        </div>
        
        <input type="hidden" id="learning_mode" value="">
        
        <div>
            <button onclick="prevStep()" class="back-btn">Back</button>
            <button onclick="nextStep()" id="learningModeNextBtn" disabled class="next-btn">Next</button>
        </div>
    </div>
    
    <!-- Step 3: Account Registration -->
    <div class="step" id="step-3">
        <h2>Step 3: Account Registration</h2>
        <p>Account registration form...</p>
        <button onclick="prevStep()" class="back-btn">Back</button>
        <button onclick="nextStep()" class="next-btn">Next</button>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let selectedPackageId = null;
        const isUserLoggedIn = false; // For testing
        
        function selectPackage(packageId, packageName, packagePrice) {
            console.log('Selecting package:', packageId, packageName, packagePrice);
            
            // Remove selection from all package cards
            document.querySelectorAll('.package-card').forEach(card => {
                card.classList.remove('selected');
                card.style.border = '';
            });
            
            // Highlight selected package
            if (event && event.target) {
                const card = event.target.closest('.package-card');
                card.classList.add('selected');
                card.style.border = '3px solid #4caf50';
            }
            
            // Store selection in global variable
            selectedPackageId = packageId;
            window.selectedPackageId = packageId;
            
            // Update hidden form input
            const packageInput = document.querySelector('input[name="package_id"]');
            if (packageInput) {
                packageInput.value = packageId;
            }
            
            // Show selected package display
            const selectedDisplay = document.getElementById('selectedPackageName');
            const selectedPackageDisplay = document.getElementById('selectedPackageDisplay');
            if (selectedDisplay) selectedDisplay.textContent = packageName;
            if (selectedPackageDisplay) selectedPackageDisplay.style.display = 'block';
            
            // Enable next button
            const nextBtn = document.getElementById('packageNextBtn');
            if (nextBtn) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
                nextBtn.classList.add('enabled');
            }
            
            updateStatus();
        }
        
        function updateStatus() {
            document.getElementById('currentStepDisplay').textContent = currentStep;
            const learningMode = document.getElementById('learning_mode').value;
            document.getElementById('learningModeDisplay').textContent = learningMode || 'None';
            
            const nextBtn = document.getElementById('learningModeNextBtn');
            const nextState = nextBtn ? (nextBtn.disabled ? 'Disabled' : 'Enabled') : 'N/A';
            document.getElementById('nextButtonState').textContent = nextState;
            
            // Update status message
            let statusMsg = 'Ready to test';
            if (currentStep === 1) statusMsg = 'Select a package to continue';
            else if (currentStep === 2) statusMsg = 'Select learning mode to enable Next button';
            else if (currentStep === 3) statusMsg = 'Fill account details';
            
            document.getElementById('statusMessage').textContent = statusMsg;
        }
        
        function selectLearningMode(mode) {
            console.log('Selecting learning mode:', mode);
            
            // Remove selection from all learning mode cards
            document.querySelectorAll('.learning-mode-card').forEach(card => {
                card.style.border = '3px solid transparent';
                card.style.boxShadow = 'none';
            });
            
            // Highlight selected learning mode using data attribute
            const selectedCard = document.querySelector(`[data-mode="${mode}"]`);
            if (selectedCard) {
                selectedCard.style.border = '3px solid #667eea';
                selectedCard.style.boxShadow = '0 8px 25px rgba(102, 126, 234, 0.3)';
                console.log('Selected card highlighted:', selectedCard);
            } else {
                console.error('No card found for mode:', mode);
            }
            
            // Update hidden input
            const learningModeInput = document.getElementById('learning_mode');
            if (learningModeInput) {
                learningModeInput.value = mode;
                console.log('Learning mode input updated:', mode);
            }
            
            // Enable next button with proper styling
            const nextBtn = document.getElementById('learningModeNextBtn');
            if (nextBtn) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
                nextBtn.style.background = 'linear-gradient(90deg,#a259c6,#6a82fb)';
                nextBtn.classList.add('enabled');
                console.log('Next button enabled and styled');
            } else {
                console.error('Next button not found');
            }
            
            updateStatus();
        }
        
        function nextStep() {
            console.log('nextStep called, current step:', currentStep);
            console.log('selectedPackageId:', selectedPackageId);
            console.log('window.selectedPackageId:', window.selectedPackageId);
            
            if (currentStep === 1) {
                // Validate package selection with multiple checks
                const packageInput = document.querySelector('input[name="package_id"]');
                const sessionPackageId = sessionStorage.getItem('selectedPackageId');
                
                console.log('Package validation - selectedPackageId:', selectedPackageId);
                console.log('Package validation - window.selectedPackageId:', window.selectedPackageId);
                console.log('Package validation - packageInput.value:', packageInput?.value);
                console.log('Package validation - sessionStorage:', sessionPackageId);
                
                if (!selectedPackageId && !window.selectedPackageId && !packageInput?.value && !sessionPackageId) {
                    alert('Please select a package before proceeding.');
                    return;
                }
                
                // Ensure selectedPackageId is set if any other method has the value
                if (!selectedPackageId && (window.selectedPackageId || packageInput?.value || sessionPackageId)) {
                    selectedPackageId = window.selectedPackageId || packageInput?.value || sessionPackageId;
                    console.log('Updated selectedPackageId to:', selectedPackageId);
                }
                
                animateStepTransition('step-1', 'step-2');
                currentStep = 2;
            } else if (currentStep === 2) {
                // Validate learning mode selection
                const learningModeValue = document.getElementById('learning_mode')?.value;
                if (!learningModeValue) {
                    alert('Please select a learning mode before proceeding.');
                    return;
                }
                animateStepTransition('step-2', 'step-3');
                currentStep = 3;
            }
            
            updateStatus();
        }
        
        function prevStep() {
            console.log('prevStep called, current step:', currentStep);
            
            if (currentStep === 3) {
                animateStepTransition('step-3', 'step-2', true);
                currentStep = 2;
            } else if (currentStep === 2) {
                animateStepTransition('step-2', 'step-1', true);
                currentStep = 1;
            }
            
            updateStatus();
        }
        
        function animateStepTransition(fromStep, toStep, isBack = false) {
            const from = document.getElementById(fromStep);
            const to = document.getElementById(toStep);
            
            if (!from || !to) {
                console.error('Step elements not found:', fromStep, toStep);
                return;
            }
            
            // Add transition classes
            from.style.transition = 'all 0.3s ease-in-out';
            to.style.transition = 'all 0.3s ease-in-out';
            
            // Hide current step
            from.style.opacity = '0';
            from.style.transform = isBack ? 'translateX(50px)' : 'translateX(-50px)';
            
            setTimeout(() => {
                // Hide current step completely
                from.style.display = 'none';
                from.classList.remove('active');
                
                // Show new step
                to.style.display = 'block';
                to.style.opacity = '0';
                to.style.transform = isBack ? 'translateX(-50px)' : 'translateX(50px)';
                to.classList.add('active');
                
                // Animate in new step
                setTimeout(() => {
                    to.style.opacity = '1';
                    to.style.transform = 'translateX(0)';
                }, 50);
                
                // Reset transforms after animation
                setTimeout(() => {
                    from.style.transform = '';
                    to.style.transform = '';
                }, 350);
            }, 300);
        }
        
        // Initialize status display
        updateStatus();
    </script>
</body>
</html>
