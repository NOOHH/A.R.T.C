<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Search Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Student Search Debug Test</h2>
        
        <div class="mb-3">
            <input type="text" id="testQuery" class="form-control" placeholder="Enter search query (e.g., nursing)" value="nursing">
            <button onclick="testSearch()" class="btn btn-primary mt-2">Test Search</button>
        </div>
        
        <div id="debug-output" class="mt-4">
            <h4>Debug Output:</h4>
            <pre id="result-display" class="bg-light p-3"></pre>
        </div>
        
        <div id="visual-results" class="mt-4">
            <h4>Visual Results:</h4>
            <div id="results-container"></div>
        </div>
    </div>

    <script>
        function testSearch() {
            const query = document.getElementById('testQuery').value;
            const resultDisplay = document.getElementById('result-display');
            const resultsContainer = document.getElementById('results-container');
            
            resultDisplay.textContent = 'Searching...';
            resultsContainer.innerHTML = '';
            
            fetch(`/search?query=${encodeURIComponent(query)}`, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                resultDisplay.textContent = JSON.stringify(data, null, 2);
                
                if (data.success && data.results && data.results.length > 0) {
                    data.results.forEach(result => {
                        const div = document.createElement('div');
                        div.className = 'card mb-2';
                        div.innerHTML = `
                            <div class="card-body">
                                <h5 class="card-title">${result.type}: ${result.name}</h5>
                                <p class="card-text">${result.description || 'No description'}</p>
                                <small class="text-muted">Role: ${result.role}</small>
                                ${result.modules_count !== undefined ? `<br><small>Modules: ${result.modules_count}, Courses: ${result.courses_count}</small>` : ''}
                            </div>
                        `;
                        resultsContainer.appendChild(div);
                    });
                } else {
                    resultsContainer.innerHTML = '<div class="alert alert-info">No results found</div>';
                }
            })
            .catch(error => {
                console.error('Search error:', error);
                resultDisplay.textContent = 'Error: ' + error.message;
                resultsContainer.innerHTML = '<div class="alert alert-danger">Search error occurred</div>';
            });
        }
        
        // Auto-run test on page load
        document.addEventListener('DOMContentLoaded', function() {
            testSearch();
        });
    </script>
</body>
</html>
