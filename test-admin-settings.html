<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token">
    <title>Admin Settings Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Admin Settings Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Professor Features</h5>
                    </div>
                    <div class="card-body">
                        <form id="professorFeaturesForm">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="ai_quiz_enabled" name="ai_quiz_enabled">
                                <label class="form-check-label" for="ai_quiz_enabled">AI Quiz Generation</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="grading_enabled" name="grading_enabled">
                                <label class="form-check-label" for="grading_enabled">Grading</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="upload_videos_enabled" name="upload_videos_enabled">
                                <label class="form-check-label" for="upload_videos_enabled">Upload Videos</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="attendance_enabled" name="attendance_enabled">
                                <label class="form-check-label" for="attendance_enabled">Attendance</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="view_programs_enabled" name="view_programs_enabled">
                                <label class="form-check-label" for="view_programs_enabled">View Programs</label>
                            </div>
                        </form>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary" onclick="saveProfessorSettings()">Save Professor Settings</button>
                            <button type="button" class="btn btn-secondary" onclick="loadProfessorSettings()">Load Professor Settings</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Director Features</h5>
                    </div>
                    <div class="card-body">
                        <form id="directorFeaturesForm">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="view_students" name="view_students">
                                <label class="form-check-label" for="view_students">View Students</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_programs" name="manage_programs">
                                <label class="form-check-label" for="manage_programs">Manage Programs</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_modules" name="manage_modules">
                                <label class="form-check-label" for="manage_modules">Manage Modules</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_enrollments" name="manage_enrollments">
                                <label class="form-check-label" for="manage_enrollments">Manage Enrollments</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="view_analytics" name="view_analytics">
                                <label class="form-check-label" for="view_analytics">View Analytics</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_professors" name="manage_professors">
                                <label class="form-check-label" for="manage_professors">Manage Professors</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_batches" name="manage_batches">
                                <label class="form-check-label" for="manage_batches">Manage Batches</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="view_chat_logs" name="view_chat_logs">
                                <label class="form-check-label" for="view_chat_logs">View Chat Logs</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="manage_settings" name="manage_settings">
                                <label class="form-check-label" for="manage_settings">Manage Settings</label>
                            </div>
                        </form>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary" onclick="saveDirectorSettings()">Save Director Settings</button>
                            <button type="button" class="btn btn-secondary" onclick="loadDirectorSettings()">Load Director Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div id="alerts"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Alert function
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.getElementById('alerts').appendChild(alertDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Professor Settings Functions
        function loadProfessorSettings() {
            fetch('/admin/settings/professor-features', {
                method: 'GET',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Professor settings loaded:', data);
                if (data) {
                    // Set checkbox values based on loaded settings
                    Object.keys(data).forEach(key => {
                        const checkbox = document.querySelector(`input[name="${key}"]`);
                        if (checkbox) {
                            checkbox.checked = data[key] === 'true' || data[key] === true;
                        }
                    });
                    showAlert('Professor settings loaded successfully!', 'success');
                } else {
                    showAlert('Error loading professor settings', 'danger');
                }
            })
            .catch(error => {
                console.error('Error loading professor settings:', error);
                showAlert('Error loading professor settings: ' + error.message, 'danger');
            });
        }

        function saveProfessorSettings() {
            const form = document.getElementById('professorFeaturesForm');
            const formData = new FormData(form);
            
            // Add unchecked checkboxes as false
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    formData.set(checkbox.name, 'false');
                } else {
                    formData.set(checkbox.name, 'true');
                }
            });

            fetch('/admin/settings/professor-features', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Professor settings saved:', data);
                if (data.success) {
                    showAlert('Professor feature settings saved successfully!', 'success');
                } else {
                    showAlert(data.error || 'Error saving professor settings', 'danger');
                }
            })
            .catch(error => {
                console.error('Error saving professor settings:', error);
                showAlert('Error saving professor settings: ' + error.message, 'danger');
            });
        }

        // Director Settings Functions
        function loadDirectorSettings() {
            fetch('/admin/settings/director-features', {
                method: 'GET',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Director settings loaded:', data);
                if (data) {
                    // Set checkbox values based on loaded settings
                    Object.keys(data).forEach(key => {
                        const checkbox = document.querySelector(`input[name="${key}"]`);
                        if (checkbox) {
                            checkbox.checked = data[key] === 'true' || data[key] === true;
                        }
                    });
                    showAlert('Director settings loaded successfully!', 'success');
                } else {
                    showAlert('Error loading director settings', 'danger');
                }
            })
            .catch(error => {
                console.error('Error loading director settings:', error);
                showAlert('Error loading director settings: ' + error.message, 'danger');
            });
        }

        function saveDirectorSettings() {
            const form = document.getElementById('directorFeaturesForm');
            const formData = new FormData(form);
            
            // Add unchecked checkboxes as false
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    formData.set(checkbox.name, 'false');
                } else {
                    formData.set(checkbox.name, 'true');
                }
            });

            fetch('/admin/settings/director-features', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Director settings saved:', data);
                if (data.success) {
                    showAlert('Director feature settings saved successfully!', 'success');
                } else {
                    showAlert(data.error || 'Error saving director settings', 'danger');
                }
            })
            .catch(error => {
                console.error('Error saving director settings:', error);
                showAlert('Error saving director settings: ' + error.message, 'danger');
            });
        }

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProfessorSettings();
            loadDirectorSettings();
        });
    </script>
</body>
</html>
