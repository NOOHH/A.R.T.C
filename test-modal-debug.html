<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Student Dashboard Modal Debug Test</h1>
    
    <div class="row">
        <div class="col-md-6">
            <button class="btn btn-warning mb-3" onclick="showStatusModal('pending', 'Test Course')">Test Status Modal (Pending)</button>
            <button class="btn btn-primary mb-3" onclick="showPaymentModal(123, 'Test Payment Course')">Test Payment Modal</button>
        </div>
        <div class="col-md-6">
            <div id="debug-output" class="debug-info">
                <strong>Debug Output:</strong><br>
                <div id="debug-content">Ready for testing...</div>
            </div>
        </div>
    </div>
    
    <!-- Status Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statusModalTitle">Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="statusModalBody">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Complete Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <h6>Payment Modal Test</h6>
                        <p>This is a test payment modal. Try to close it using:</p>
                        <ul class="list-unstyled">
                            <li>• ESC key</li>
                            <li>• Backdrop click</li>
                            <li>• Close button (X)</li>
                            <li>• Cancel button</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Proceed to Payment</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let statusModalInstance = null;
        let paymentModalInstance = null;
        
        function debugLog(message) {
            const debugContent = document.getElementById('debug-content');
            const timestamp = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<br>[${timestamp}] ${message}`;
            console.log(message);
        }
        
        function showStatusModal(status, courseName) {
            debugLog(`showStatusModal called with: ${status}, ${courseName}`);
            
            const statusModalElement = document.getElementById('statusModal');
            if (!statusModalElement) {
                debugLog('ERROR: Status modal element not found');
                return;
            }
            
            const title = document.getElementById('statusModalTitle');
            const body = document.getElementById('statusModalBody');
            
            title.textContent = 'Pending Verification';
            body.innerHTML = `
                <div class="text-center">
                    <i class="bi bi-hourglass-split text-warning" style="font-size: 3rem;">⏳</i>
                    <h5 class="mt-3">Enrollment Under Review</h5>
                    <p>Your enrollment for <strong>${courseName}</strong> is currently being reviewed.</p>
                    <div class="alert alert-info">
                        Please wait for admin approval. You will be notified once verified.
                    </div>
                </div>
            `;
            
            // Clean up any existing instance
            if (statusModalInstance) {
                statusModalInstance.dispose();
                debugLog('Disposed existing status modal instance');
            }
            
            // Create new modal instance with NORMAL settings (not static)
            statusModalInstance = new bootstrap.Modal(statusModalElement, {
                backdrop: true,  // Allow closing with backdrop click
                keyboard: true,  // Allow closing with ESC key
                focus: true
            });
            
            // Add event listeners to track what's happening
            statusModalElement.addEventListener('show.bs.modal', function() {
                debugLog('Status modal starting to show...');
            }, { once: true });
            
            statusModalElement.addEventListener('shown.bs.modal', function() {
                debugLog('Status modal fully shown and interactive');
            }, { once: true });
            
            statusModalElement.addEventListener('hide.bs.modal', function() {
                debugLog('Status modal starting to hide...');
            }, { once: true });
            
            statusModalElement.addEventListener('hidden.bs.modal', function() {
                debugLog('Status modal fully hidden');
            }, { once: true });
            
            // Show the modal
            statusModalInstance.show();
            debugLog('Status modal show() called');
        }
        
        function showPaymentModal(enrollmentId, courseName) {
            debugLog(`showPaymentModal called with: ${enrollmentId}, ${courseName}`);
            
            const paymentModalElement = document.getElementById('paymentModal');
            if (!paymentModalElement) {
                debugLog('ERROR: Payment modal element not found');
                return;
            }
            
            const label = document.getElementById('paymentModalLabel');
            label.textContent = `Complete Payment - ${courseName}`;
            
            // Clean up any existing instance
            if (paymentModalInstance) {
                paymentModalInstance.dispose();
                debugLog('Disposed existing payment modal instance');
            }
            
            // Create new modal instance with NORMAL settings (not static)
            paymentModalInstance = new bootstrap.Modal(paymentModalElement, {
                backdrop: true,  // Allow closing with backdrop click
                keyboard: true,  // Allow closing with ESC key
                focus: true
            });
            
            // Add event listeners to track what's happening
            paymentModalElement.addEventListener('show.bs.modal', function() {
                debugLog('Payment modal starting to show...');
            }, { once: true });
            
            paymentModalElement.addEventListener('shown.bs.modal', function() {
                debugLog('Payment modal fully shown and interactive');
            }, { once: true });
            
            paymentModalElement.addEventListener('hide.bs.modal', function() {
                debugLog('Payment modal starting to hide...');
            }, { once: true });
            
            paymentModalElement.addEventListener('hidden.bs.modal', function() {
                debugLog('Payment modal fully hidden');
            }, { once: true });
            
            // Show the modal
            paymentModalInstance.show();
            debugLog('Payment modal show() called');
        }
        
        // Test keyboard events
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                debugLog('ESC key pressed');
            }
        });
        
        debugLog('Modal test page loaded and ready');
    </script>
</body>
</html>
