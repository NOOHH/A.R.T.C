<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat System Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Chat System Test</h1>
        
        <!-- Admin Login Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Admin Login Test</h3>
            </div>
            <div class="card-body">
                <form id="adminLoginForm">
                    <div class="mb-3">
                        <label for="admin_email" class="form-label">Admin Email</label>
                        <input type="email" class="form-control" id="admin_email" name="admin_email" value="admin@example.com">
                    </div>
                    <div class="mb-3">
                        <label for="admin_password" class="form-label">Admin Password</label>
                        <input type="password" class="form-control" id="admin_password" name="admin_password" value="password">
                    </div>
                    <button type="submit" class="btn btn-primary">Login as Admin</button>
                </form>
                <div id="loginResult" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Chat Search Test Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Chat Search Test</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h5>Search Professors</h5>
                        <input type="text" class="form-control mb-2" id="professorSearch" placeholder="Search professors..." value="robert">
                        <button class="btn btn-primary btn-sm" onclick="searchProfessors()">Search</button>
                        <div id="professorResults" class="mt-2"></div>
                    </div>
                    <div class="col-md-4">
                        <h5>Search Users</h5>
                        <input type="text" class="form-control mb-2" id="userSearch" placeholder="Search users..." value="test">
                        <button class="btn btn-primary btn-sm" onclick="searchUsers()">Search</button>
                        <div id="userResults" class="mt-2"></div>
                    </div>
                    <div class="col-md-4">
                        <h5>Search Admins</h5>
                        <input type="text" class="form-control mb-2" id="adminSearch" placeholder="Search admins..." value="admin">
                        <button class="btn btn-primary btn-sm" onclick="searchAdmins()">Search</button>
                        <div id="adminResults" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Session Debug Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Session Debug</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-info" onclick="checkSession()">Check Session</button>
                <div id="sessionInfo" class="mt-2"></div>
            </div>
        </div>
        
        <!-- Direct Database Test Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Direct Database Test</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-success" onclick="testDatabase()">Test Database</button>
                <div id="databaseInfo" class="mt-2"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Admin login function
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/admin/login', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loginResult').innerHTML = 
                    '<div class="alert alert-' + (data.success ? 'success' : 'danger') + '">' + 
                    JSON.stringify(data, null, 2) + 
                    '</div>';
            })
            .catch(error => {
                document.getElementById('loginResult').innerHTML = 
                    '<div class="alert alert-danger">Error: ' + error.message + '</div>';
            });
        });
        
        // Search functions
        function searchProfessors() {
            const search = document.getElementById('professorSearch').value;
            fetch(`/api/chat/session/search/professors?search=${encodeURIComponent(search)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('professorResults').innerHTML = 
                        '<div class="alert alert-info"><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                })
                .catch(error => {
                    document.getElementById('professorResults').innerHTML = 
                        '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        function searchUsers() {
            const search = document.getElementById('userSearch').value;
            fetch(`/api/chat/session/search/users?search=${encodeURIComponent(search)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('userResults').innerHTML = 
                        '<div class="alert alert-info"><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                })
                .catch(error => {
                    document.getElementById('userResults').innerHTML = 
                        '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        function searchAdmins() {
            const search = document.getElementById('adminSearch').value;
            fetch(`/api/chat/session/search/admins?search=${encodeURIComponent(search)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('adminResults').innerHTML = 
                        '<div class="alert alert-info"><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                })
                .catch(error => {
                    document.getElementById('adminResults').innerHTML = 
                        '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        function checkSession() {
            fetch('/test-admin-auth.php')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('sessionInfo').innerHTML = 
                        '<div class="alert alert-info">' + data + '</div>';
                })
                .catch(error => {
                    document.getElementById('sessionInfo').innerHTML = 
                        '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        function testDatabase() {
            fetch('/debug/professors')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('databaseInfo').innerHTML = 
                        '<div class="alert alert-info"><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                })
                .catch(error => {
                    document.getElementById('databaseInfo').innerHTML = 
                        '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            searchProfessors();
            searchUsers();
            searchAdmins();
            checkSession();
            testDatabase();
        });
    </script>
</body>
</html>
