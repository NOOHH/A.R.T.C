<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARTC Batch Management - Visual Drag & Drop Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .student-drop-zone {
            min-height: 200px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .student-drop-zone.drag-over {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .student-row[draggable="true"] {
            cursor: grab;
        }
        
        .student-row[draggable="true"]:active {
            cursor: grabbing;
        }
        
        .student-row:hover {
            background-color: #f8f9fa;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-users"></i> ARTC Batch Management - Visual Drag & Drop Test</h4>
                        <small class="text-muted">
                            This test demonstrates the visual drag-and-drop functionality that does NOT change the actual enrollment/payment status in the database.
                        </small>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Important:</strong> Moving students between "Current" and "Pending" tables is purely visual/organizational and does NOT change their actual enrollment_status or payment_status in the database.
                        </div>
                        
                        <div class="row">
                            <!-- Current Students -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5><i class="fas fa-check-circle"></i> Current Students (<span class="current-count">2</span>)</h5>
                                        <small>Students who appear in the "current" view for organizational purposes</small>
                                    </div>
                                    <div class="card-body student-drop-zone current-students-table" data-target="current" data-batch-id="1">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th width="30px"></th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Enrollment Status</th>
                                                    <th>Payment Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="student-row" draggable="true" data-enrollment-id="1" data-student-type="current">
                                                    <td><i class="fas fa-grip-vertical text-muted" style="cursor: grab;"></i></td>
                                                    <td>John Doe</td>
                                                    <td>john@example.com</td>
                                                    <td><span class="badge badge-success">approved</span></td>
                                                    <td><span class="badge badge-success">paid</span></td>
                                                </tr>
                                                <tr class="student-row" draggable="true" data-enrollment-id="2" data-student-type="current">
                                                    <td><i class="fas fa-grip-vertical text-muted" style="cursor: grab;"></i></td>
                                                    <td>Jane Smith</td>
                                                    <td>jane@example.com</td>
                                                    <td><span class="badge badge-success">approved</span></td>
                                                    <td><span class="badge badge-success">paid</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pending Students -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-warning text-dark">
                                        <h5><i class="fas fa-clock"></i> Pending Students (<span class="pending-count">2</span>)</h5>
                                        <small>Students who appear in the "pending" view for organizational purposes</small>
                                    </div>
                                    <div class="card-body student-drop-zone pending-students-table" data-target="pending" data-batch-id="1">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th width="30px"></th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Enrollment Status</th>
                                                    <th>Payment Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="student-row" draggable="true" data-enrollment-id="3" data-student-type="pending">
                                                    <td><i class="fas fa-grip-vertical text-muted" style="cursor: grab;"></i></td>
                                                    <td>Bob Johnson</td>
                                                    <td>bob@example.com</td>
                                                    <td><span class="badge badge-warning">pending</span></td>
                                                    <td><span class="badge badge-warning">pending</span></td>
                                                </tr>
                                                <tr class="student-row" draggable="true" data-enrollment-id="4" data-student-type="pending">
                                                    <td><i class="fas fa-grip-vertical text-muted" style="cursor: grab;"></i></td>
                                                    <td>Alice Brown</td>
                                                    <td>alice@example.com</td>
                                                    <td><span class="badge badge-success">approved</span></td>
                                                    <td><span class="badge badge-warning">pending</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-secondary">
                                    <h6><i class="fas fa-instructions"></i> Instructions:</h6>
                                    <ul class="mb-0">
                                        <li>Drag students from one table to another using the grip icon</li>
                                        <li>This is purely visual - no database changes occur</li>
                                        <li>The original enrollment_status and payment_status remain unchanged</li>
                                        <li>This allows admins to organize students visually for batch management</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Drag and Drop Variables
        let draggedElement = null;

        // Initialize drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
        });

        function setupDragAndDrop() {
            // Setup drag for student rows
            const studentRows = document.querySelectorAll('.student-row');
            studentRows.forEach(row => {
                row.addEventListener('dragstart', handleDragStart);
                row.addEventListener('dragend', handleDragEnd);
            });

            // Setup drop zones
            const dropZones = document.querySelectorAll('.student-drop-zone');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.target.style.opacity = '0.4';
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedElement = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            e.target.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            if (!e.target.contains(e.relatedTarget)) {
                e.target.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            e.target.classList.remove('drag-over');
            
            if (draggedElement) {
                const targetType = e.target.dataset.target;
                const studentType = draggedElement.dataset.studentType;
                
                // Don't allow dropping in the same zone
                if (targetType === studentType) {
                    return false;
                }
                
                // Move student visually
                moveStudentVisually(draggedElement, targetType);
            }
            
            return false;
        }

        function moveStudentVisually(studentElement, targetType) {
            // Get student data
            const enrollmentId = studentElement.dataset.enrollmentId;
            const studentName = studentElement.querySelector('td:nth-child(2)').textContent;
            const studentEmail = studentElement.querySelector('td:nth-child(3)').textContent;
            const enrollmentStatus = studentElement.querySelector('td:nth-child(4)').textContent;
            const paymentStatus = studentElement.querySelector('td:nth-child(5)').textContent;
            
            // Remove from current location
            studentElement.remove();
            
            // Find target table body
            const targetTableBody = document.querySelector(`.${targetType}-students-table tbody`);
            
            // Create new row in target location
            const newRow = document.createElement('tr');
            newRow.className = 'student-row';
            newRow.draggable = true;
            newRow.dataset.enrollmentId = enrollmentId;
            newRow.dataset.studentType = targetType;
            
            newRow.innerHTML = `
                <td>
                    <i class="fas fa-grip-vertical text-muted" style="cursor: grab;"></i>
                </td>
                <td>${studentName}</td>
                <td>${studentEmail}</td>
                <td>${enrollmentStatus}</td>
                <td>${paymentStatus}</td>
            `;
            
            // Add drag event listeners to the new row
            newRow.addEventListener('dragstart', handleDragStart);
            newRow.addEventListener('dragend', handleDragEnd);
            
            // Append to target table
            targetTableBody.appendChild(newRow);
            
            // Update counters
            updateStudentCounts();
            
            // Show success message
            showToast('Student moved successfully! Note: This is a visual change only and does not affect the actual enrollment or payment status in the database.', 'success');
        }

        function updateStudentCounts() {
            // Count current and pending students
            const currentCount = document.querySelectorAll('.current-students-table tbody tr').length;
            const pendingCount = document.querySelectorAll('.pending-students-table tbody tr').length;
            
            // Update counter displays
            document.querySelector('.current-count').textContent = currentCount;
            document.querySelector('.pending-count').textContent = pendingCount;
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} alert-dismissible fade show`;
            toast.style.cssText = 'min-width: 300px; margin-bottom: 10px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            `;
            
            // Add to container
            const container = document.querySelector('.toast-container');
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 5000);
        }
    </script>
</body>
</html>
