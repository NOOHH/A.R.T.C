<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARTC System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ARTC System Comprehensive Test</h1>
    
    <div class="test-section">
        <h2>1. Test Registration with Batch Selection</h2>
        <button onclick="testRegistration()">Test Registration</button>
        <div id="registration-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test Mark as Paid (Admin)</h2>
        <input type="number" id="enrollment-id" placeholder="Enrollment ID" value="79">
        <button onclick="testMarkAsPaid()">Mark as Paid</button>
        <div id="payment-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Test Batch Management</h2>
        <input type="number" id="batch-id" placeholder="Batch ID" value="1">
        <button onclick="testBatchStudents()">Get Batch Students</button>
        <button onclick="testBatchUpdate()">Test Batch Update</button>
        <div id="batch-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Test Student Dashboard Data</h2>
        <button onclick="testStudentDashboard()">Load Student Dashboard</button>
        <div id="dashboard-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Test Paywall Logic</h2>
        <input type="number" id="course-id" placeholder="Course ID" value="23">
        <button onclick="testPaywall()">Test Course Access</button>
        <div id="paywall-result" class="result"></div>
    </div>

    <script>
        function testRegistration() {
            const result = document.getElementById('registration-result');
            result.innerHTML = '<div class="info">Testing registration with batch selection...</div>';
            
            const testData = {
                program_id: 23,
                package_id: 2,
                enrollment_type: 'Full',
                learning_mode: 'synchronous',
                batch_id: 1,
                user_firstname: 'Test',
                user_lastname: 'User',
                email: 'test' + Date.now() + '@example.com',
                password: 'password',
                password_confirmation: 'password',
                _token: '{{ csrf_token() }}'
            };
            
            fetch('/registration/final-submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                },
                body: JSON.stringify(testData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    result.innerHTML = '<div class="success">✓ Registration successful with batch_id</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Registration failed: ' + (data.message || 'Unknown error') + '</div>';
                }
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Network error: ' + error.message + '</div>';
            });
        }
        
        function testMarkAsPaid() {
            const enrollmentId = document.getElementById('enrollment-id').value;
            const result = document.getElementById('payment-result');
            result.innerHTML = '<div class="info">Testing mark as paid...</div>';
            
            fetch(`/admin/mark-as-paid/${enrollmentId}`, {
                method: 'POST',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    result.innerHTML = '<div class="success">✓ Payment marked as paid successfully</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Mark as paid failed: ' + (data.message || 'Unknown error') + '</div>';
                }
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Network error: ' + error.message + '</div>';
            });
        }
        
        function testBatchStudents() {
            const batchId = document.getElementById('batch-id').value;
            const result = document.getElementById('batch-result');
            result.innerHTML = '<div class="info">Loading batch students...</div>';
            
            fetch(`/admin/batch/${batchId}/students`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    result.innerHTML = '<div class="success">✓ Batch students loaded successfully. Count: ' + data.students.length + '</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Failed to load students: ' + (data.error || 'Unknown error') + '</div>';
                }
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Network error: ' + error.message + '</div>';
            });
        }
        
        function testBatchUpdate() {
            const batchId = document.getElementById('batch-id').value;
            const result = document.getElementById('batch-result');
            result.innerHTML = '<div class="info">Testing batch update...</div>';
            
            const updateData = {
                batch_name: 'Test Batch Update',
                program_id: 23,
                max_capacity: 15,
                registration_deadline: '2025-07-20',
                start_date: '2025-07-25',
                description: 'Test update',
                _token: '{{ csrf_token() }}'
            };
            
            fetch(`/admin/batch/${batchId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    result.innerHTML = '<div class="success">✓ Batch updated successfully</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Batch update failed: ' + (data.message || 'Unknown error') + '</div>';
                }
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Network error: ' + error.message + '</div>';
            });
        }
        
        function testStudentDashboard() {
            const result = document.getElementById('dashboard-result');
            result.innerHTML = '<div class="info">Loading student dashboard...</div>';
            
            fetch('/student/dashboard')
            .then(response => response.text())
            .then(html => {
                const hasPrograms = html.includes('My Programs');
                const hasBatchInfo = html.includes('batch-info') || html.includes('batch_name');
                
                let message = '✓ Dashboard loaded successfully<br>';
                message += '- Programs section: ' + (hasPrograms ? '✓' : '✗') + '<br>';
                message += '- Batch information: ' + (hasBatchInfo ? '✓' : '✗');
                
                result.innerHTML = '<div class="success">' + message + '</div>';
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Dashboard load failed: ' + error.message + '</div>';
            });
        }
        
        function testPaywall() {
            const courseId = document.getElementById('course-id').value;
            const result = document.getElementById('paywall-result');
            result.innerHTML = '<div class="info">Testing course access...</div>';
            
            fetch(`/student/course/${courseId}`)
            .then(response => response.text())
            .then(html => {
                const hasPaywall = html.includes('Get Access Now') || html.includes('paywall');
                const hasCourseContent = html.includes('module') && !hasPaywall;
                
                let message = '✓ Course page loaded<br>';
                message += '- Shows paywall: ' + (hasPaywall ? '✓' : '✗') + '<br>';
                message += '- Shows course content: ' + (hasCourseContent ? '✓' : '✗');
                
                result.innerHTML = '<div class="' + (hasPaywall ? 'error' : 'success') + '">' + message + '</div>';
            })
            .catch(error => {
                result.innerHTML = '<div class="error">✗ Course access test failed: ' + error.message + '</div>';
            });
        }
    </script>
</body>
</html>
