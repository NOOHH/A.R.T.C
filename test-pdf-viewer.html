<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section { margin: 20px 0; border: 1px solid #ccc; padding: 20px; }
        .pdf-viewer { border: 2px solid #007bff; border-radius: 8px; padding: 15px; }
        .log-area { background: #f5f5f5; padding: 10px; min-height: 150px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç PDF Viewer & Content Test</h1>
        
        <div class="test-section">
            <h2>1. Test PDF Files in Storage</h2>
            <button onclick="testPDFFiles()" class="btn btn-primary">Test PDF Access</button>
            <div id="pdfTestResults" class="mt-3"></div>
        </div>
        
        <div class="test-section">
            <h2>2. PDF Embedded Viewer Test</h2>
            <select id="pdfSelector" class="form-select mb-3">
                <option value="">Select a PDF to test</option>
                <option value="content/test_module_1753044980.pdf">test_module_1753044980.pdf</option>
                <option value="content/test_module_1753045086.pdf">test_module_1753045086.pdf</option>
                <option value="content/1752938462_Vince_Certificate.pdf">1752938462_Vince_Certificate.pdf</option>
            </select>
            <button onclick="loadSelectedPDF()" class="btn btn-success">Load PDF Viewer</button>
            
            <div id="pdfViewerContainer" class="mt-4" style="min-height: 400px;"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Content API Test</h2>
            <button onclick="testContentAPI()" class="btn btn-warning">Test Content Endpoints</button>
            <div class="log-area mt-3" id="apiLog"></div>
        </div>
    </div>

    <script>
        function log(message, containerId = 'apiLog') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            container.innerHTML += `[${timestamp}] ${message}<br>`;
            container.scrollTop = container.scrollHeight;
        }

        async function testPDFFiles() {
            const results = document.getElementById('pdfTestResults');
            results.innerHTML = '<div class="spinner-border" role="status"></div> Testing PDF file access...';
            
            const pdfFiles = [
                'content/test_module_1753044980.pdf',
                'content/test_module_1753045086.pdf', 
                'content/1752938462_Vince_Certificate.pdf'
            ];
            
            let resultsHtml = '<h4>PDF File Access Results:</h4><ul>';
            
            for (const file of pdfFiles) {
                const url = `/storage/${file}`;
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    const status = response.ok ? '‚úÖ Accessible' : `‚ùå Error ${response.status}`;
                    resultsHtml += `<li><code>${file}</code>: ${status}</li>`;
                } catch (error) {
                    resultsHtml += `<li><code>${file}</code>: ‚ùå Network Error</li>`;
                }
            }
            
            resultsHtml += '</ul>';
            results.innerHTML = resultsHtml;
        }

        function loadSelectedPDF() {
            const selector = document.getElementById('pdfSelector');
            const container = document.getElementById('pdfViewerContainer');
            
            if (!selector.value) {
                alert('Please select a PDF file');
                return;
            }
            
            const fileUrl = `/storage/${selector.value}`;
            const fileName = selector.value.split('/').pop();
            
            container.innerHTML = `
                <div class="pdf-viewer">
                    <h5>üìÑ ${fileName}</h5>
                    <div class="pdf-controls mb-3">
                        <div class="btn-group">
                            <a href="${fileUrl}" target="_blank" class="btn btn-primary btn-sm">
                                <i class="bi bi-fullscreen"></i> Open Full Screen
                            </a>
                            <a href="${fileUrl}" download class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-download"></i> Download
                            </a>
                            <button onclick="testPDFViewMode('${fileUrl}')" class="btn btn-info btn-sm">
                                Test Different View Mode
                            </button>
                        </div>
                    </div>
                    
                    <div class="pdf-embed-container">
                        <iframe src="${fileUrl}#toolbar=1&navpanes=1&scrollbar=1&page=1&zoom=85" 
                                style="width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 5px;"
                                id="pdfFrame"
                                allowfullscreen>
                            <p>Your browser does not support PDF viewing. 
                               <a href="${fileUrl}" target="_blank">Download the PDF</a>
                            </p>
                        </iframe>
                    </div>
                    
                    <div class="mt-2">
                        <small class="text-muted">
                            Direct URL: <a href="${fileUrl}" target="_blank">${fileUrl}</a>
                        </small>
                    </div>
                </div>
            `;
        }

        function testPDFViewMode(fileUrl) {
            const frame = document.getElementById('pdfFrame');
            const currentSrc = frame.src;
            
            if (currentSrc.includes('#toolbar=1')) {
                // Switch to minimal view
                frame.src = `${fileUrl}#toolbar=0&navpanes=0&scrollbar=1&page=1&zoom=100`;
                log('Switched to minimal PDF view mode');
            } else {
                // Switch back to full toolbar
                frame.src = `${fileUrl}#toolbar=1&navpanes=1&scrollbar=1&page=1&zoom=85`;
                log('Switched to full PDF view mode');
            }
        }

        async function testContentAPI() {
            log('üß™ Testing content API endpoints...');
            
            // Test module list
            try {
                const response = await fetch('/admin/modules?program_id=32');
                if (response.ok) {
                    log('‚úÖ Admin modules endpoint accessible');
                } else {
                    log(`‚ùå Admin modules endpoint error: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Admin modules endpoint failed: ${error.message}`);
            }
            
            // Test module content endpoint (using a test module ID)
            try {
                const response = await fetch('/admin/modules/1/content');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Module content endpoint working: ${JSON.stringify(data).substring(0, 100)}...`);
                } else {
                    log(`‚ùå Module content endpoint error: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Module content endpoint failed: ${error.message}`);
            }
            
            // Test content item endpoint
            try {
                const response = await fetch('/admin/content/1');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Content item endpoint working: ${JSON.stringify(data).substring(0, 100)}...`);
                } else {
                    log(`‚ùå Content item endpoint error: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Content item endpoint failed: ${error.message}`);
            }
        }
        
        // Auto-run PDF file test on load
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ PDF Viewer test page loaded');
            testPDFFiles();
        });
    </script>
</body>
</html>
