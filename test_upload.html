<!DOCTYPE html>
<html>
<head>
    <title>Simple Upload Test</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <h1>Simple File Upload Test</h1>
    
    <form action="http://127.0.0.1:8000/test-upload" method="POST" enctype="multipart/form-data" id="testForm">
        <input type="hidden" name="_token" value="">
        
        <label>File:</label><br>
        <input type="file" name="attachment" required><br><br>
        
        <button type="submit">Upload File</button>
    </form>
    
    <div id="result"></div>
    
    <script>
        // Get CSRF token and set it
        fetch('/admin/login')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const token = doc.querySelector('meta[name="csrf-token"]');
                if (token) {
                    document.querySelector('input[name="_token"]').value = token.getAttribute('content');
                } else {
                    // Fallback - try to get from cookies
                    const cookies = document.cookie.split(';');
                    for (let cookie of cookies) {
                        if (cookie.trim().startsWith('XSRF-TOKEN=')) {
                            const tokenValue = decodeURIComponent(cookie.trim().substring(11));
                            document.querySelector('input[name="_token"]').value = tokenValue;
                            break;
                        }
                    }
                }
            })
            .catch(() => {
                // Manual token entry
                const token = prompt('Enter CSRF token (check browser dev tools):');
                if (token) document.querySelector('input[name="_token"]').value = token;
            });

        // Handle form submission
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/test-upload', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerHTML = 
                    '<h3>Result:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(error => {
                document.getElementById('result').innerHTML = 
                    '<h3>Error:</h3><pre>' + error + '</pre>';
            });
        });
    </script>
</body>
</html>
