<!DOCTYPE html>
<html>
<head>
    <title>Test Quiz Generator</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <h1>Test Quiz Generator</h1>
    
    <form id="testForm">
        <div>
            <label>Program:</label>
            <select id="program_id">
                <option value="">Select Program</option>
                <option value="1">Program 1</option>
                <option value="2">Program 2</option>
            </select>
        </div>
        
        <div>
            <label>Batch:</label>
            <select id="batch_id" disabled>
                <option value="">Select Batch</option>
            </select>
        </div>
    </form>
    
    <script>
        const programSelect = document.getElementById('program_id');
        const batchSelect = document.getElementById('batch_id');
        
        programSelect.addEventListener('change', function() {
            const pid = this.value;
            batchSelect.innerHTML = '<option value="">Choose a batchâ€¦</option>';
            batchSelect.disabled = true;

            if (!pid) {
                return;
            }

            const url = `/admin/programs/${pid}/batches`;
            console.log('Fetching batches from:', url);

            fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then(data => {
                    console.log('Response:', data);
                    if (data.success && data.batches) {
                        data.batches.forEach(batch => {
                            batchSelect.add(new Option(batch.batch_name, batch.id));
                        });
                        batchSelect.disabled = false;
                    } else {
                        console.error('Error in response:', data.message || 'Unknown error');
                    }
                })
                .catch(err => {
                    console.error('Error fetching batches:', err);
                    batchSelect.disabled = false;
                });
        });
    </script>
</body>
</html>
