<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARTC Chat System Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3>ARTC Enhanced Chat System Test</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Test Features:</h5>
                                <ul class="list-group">
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        User Type Selection (Admin, Student, Professor)
                                    </li>
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        FAQ Bot with Intelligent Responses
                                    </li>
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        Chat History Persistence
                                    </li>
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        Group Chat Creation (Admin/Director)
                                    </li>
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        FAQ Management System
                                    </li>
                                    <li class="list-group-item">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        Real-time Messaging Simulation
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Test Authentication:</h5>
                                <div class="btn-group d-flex mb-3">
                                    <button class="btn btn-outline-primary" onclick="simulateAuth('admin')">Test as Admin</button>
                                    <button class="btn btn-outline-success" onclick="simulateAuth('professor')">Test as Professor</button>
                                    <button class="btn btn-outline-info" onclick="simulateAuth('student')">Test as Student</button>
                                    <button class="btn btn-outline-secondary" onclick="simulateAuth('guest')">Test as Guest</button>
                                </div>
                                
                                <h5>Current User:</h5>
                                <div id="currentUser" class="alert alert-info">
                                    <strong>Guest User</strong><br>
                                    <small>No authentication - Limited features</small>
                                </div>
                                
                                <h5>Test Chat:</h5>
                                <button class="btn btn-primary chat-trigger" data-bs-toggle="offcanvas" data-bs-target="#chatOffcanvas">
                                    <i class="bi bi-chat-dots me-2"></i>Open Chat System
                                </button>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5>System Requirements Fulfilled:</h5>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card border-success">
                                            <div class="card-body text-center">
                                                <i class="bi bi-people-fill text-success display-4"></i>
                                                <h6 class="mt-2">Multi-User Chat</h6>
                                                <p class="text-muted small">Choose who to chat with</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-info">
                                            <div class="card-body text-center">
                                                <i class="bi bi-robot text-info display-4"></i>
                                                <h6 class="mt-2">FAQ Bot</h6>
                                                <p class="text-muted small">Intelligent responses</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-warning">
                                            <div class="card-body text-center">
                                                <i class="bi bi-clock-history text-warning display-4"></i>
                                                <h6 class="mt-2">Chat History</h6>
                                                <p class="text-muted small">Persistent conversations</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include the enhanced chat component -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="chatOffcanvas" aria-labelledby="chatOffcanvasLabel" style="width: 400px;">
        <div class="offcanvas-header border-bottom">
            <h5 class="offcanvas-title fw-bold text-primary" id="chatOffcanvasLabel">
                <i class="bi bi-chat-dots me-2"></i>Live Chat
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        
        <!-- Chat Selection Panel -->
        <div id="chatSelectionPanel" class="p-3 border-bottom">
            <h6 class="mb-3">Choose who to chat with:</h6>
            
            <!-- User Type Selection -->
            <div class="user-type-selection mb-3">
                <div id="adminOptions" class="d-none">
                    <div class="row g-2">
                        <div class="col-4">
                            <button class="btn btn-outline-primary w-100 btn-sm" onclick="selectUserType('student')">
                                <i class="bi bi-person-circle d-block"></i>
                                <small>Students</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-success w-100 btn-sm" onclick="selectUserType('professor')">
                                <i class="bi bi-person-badge d-block"></i>
                                <small>Professors</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-info w-100 btn-sm" onclick="selectUserType('support')">
                                <i class="bi bi-headset d-block"></i>
                                <small>Support</small>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="professorOptions" class="d-none">
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-outline-primary w-100 btn-sm" onclick="selectUserType('student')">
                                <i class="bi bi-person-circle d-block"></i>
                                <small>Students</small>
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-info w-100 btn-sm" onclick="selectUserType('support')">
                                <i class="bi bi-headset d-block"></i>
                                <small>Support</small>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="studentOptions" class="d-none">
                    <div class="row g-2">
                        <div class="col-4">
                            <button class="btn btn-outline-success w-100 btn-sm" onclick="selectUserType('professor')">
                                <i class="bi bi-person-badge d-block"></i>
                                <small>Professors</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-info w-100 btn-sm" onclick="selectUserType('support')">
                                <i class="bi bi-headset d-block"></i>
                                <small>Support</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-warning w-100 btn-sm" onclick="selectUserType('faq')">
                                <i class="bi bi-question-circle d-block"></i>
                                <small>FAQ Bot</small>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="guestOptions">
                    <div class="text-center">
                        <button class="btn btn-outline-warning" onclick="selectUserType('faq')">
                            <i class="bi bi-question-circle me-1"></i>FAQ Bot
                        </button>
                        <p class="text-muted small mt-2">Please log in to chat with users</p>
                    </div>
                </div>
            </div>
            
            <!-- Available Users List -->
            <div id="availableUsers" class="d-none">
                <h6 class="mb-2">Available Users:</h6>
                <div class="available-users-list" style="max-height: 200px; overflow-y: auto;">
                    <!-- Users will be populated here -->
                </div>
            </div>
            
            <!-- Group Chat Options -->
            <div id="groupChatOptions" class="group-chat-options mt-3 d-none">
                <button class="btn btn-outline-secondary btn-sm w-100" onclick="createGroupChat()">
                    <i class="bi bi-people me-1"></i>Create Group Chat
                </button>
            </div>
        </div>
        
        <!-- Chat Interface -->
        <div id="chatInterface" class="d-none flex-grow-1 d-flex flex-column">
            <!-- Chat Header -->
            <div class="chat-header p-3 border-bottom bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="chat-avatar me-2">
                            <i class="bi bi-person-circle text-primary" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <div class="fw-medium" id="chatWithName">Support Team</div>
                            <small class="text-muted" id="chatStatus">Online</small>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-sm btn-outline-secondary" onclick="backToSelection()">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="clearChatHistory()">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages Area -->
            <div id="chatMessages" class="flex-grow-1 overflow-auto p-3" style="max-height: calc(100vh - 300px);">
                <!-- Messages will be populated here -->
            </div>
            
            <!-- FAQ Quick Responses -->
            <div id="faqQuickResponses" class="d-none p-3 border-top">
                <h6 class="mb-2">Frequently Asked Questions:</h6>
                <div class="faq-buttons">
                    <button class="btn btn-sm btn-outline-primary mb-2 w-100" onclick="selectFAQ('enrollment')">
                        How do I enroll in a course?
                    </button>
                    <button class="btn btn-sm btn-outline-primary mb-2 w-100" onclick="selectFAQ('payment')">
                        What are the payment options?
                    </button>
                    <button class="btn btn-sm btn-outline-primary mb-2 w-100" onclick="selectFAQ('schedule')">
                        How do I check my class schedule?
                    </button>
                    <button class="btn btn-sm btn-outline-primary mb-2 w-100" onclick="selectFAQ('certificate')">
                        How do I get my certificate?
                    </button>
                    <button class="btn btn-sm btn-outline-primary mb-2 w-100" onclick="selectFAQ('support')">
                        How do I contact support?
                    </button>
                </div>
            </div>
            
            <!-- Chat Input Form -->
            <div class="border-top p-3 bg-light">
                <form id="chatForm" class="d-flex gap-2">
                    <input 
                        type="text" 
                        id="chatInput" 
                        class="form-control" 
                        placeholder="Type your message..."
                        autocomplete="off"
                        maxlength="500"
                        required
                    >
                    <button type="submit" class="btn btn-primary d-flex align-items-center justify-content-center" style="min-width: 45px;">
                        <i class="bi bi-send"></i>
                    </button>
                </form>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        <span id="userStatus">Guest User - Limited features</span>
                    </small>
                    <small class="text-muted">
                        <span id="typingIndicator" class="d-none">
                            <i class="bi bi-three-dots text-primary"></i>
                            Someone is typing...
                        </span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentUserRole = 'guest';
        let currentUserName = 'Guest User';
        let currentChatType = null;
        let currentChatUser = null;
        let chatHistory = {};
        
        // FAQ responses
        const faqResponses = {
            enrollment: {
                question: "How do I enroll in a course?",
                answer: "To enroll in a course:\n1. Log into your student dashboard\n2. Go to 'Available Courses'\n3. Select your desired course\n4. Click 'Enroll Now'\n5. Complete the payment process\n\nIf you need help with enrollment, please contact our support team."
            },
            payment: {
                question: "What are the payment options?",
                answer: "We accept the following payment methods:\n• Credit/Debit Cards (Visa, Mastercard)\n• PayPal\n• Bank Transfer\n• Online Banking\n• Installment Plans (available for select courses)\n\nAll payments are processed securely through our encrypted payment gateway."
            },
            schedule: {
                question: "How do I check my class schedule?",
                answer: "To view your class schedule:\n1. Login to your dashboard\n2. Go to 'My Courses'\n3. Click on 'Schedule' tab\n4. Select the course to view detailed schedule\n\nYou can also sync your schedule with your calendar app by clicking the 'Export to Calendar' button."
            },
            certificate: {
                question: "How do I get my certificate?",
                answer: "To receive your certificate:\n1. Complete all course modules\n2. Pass all required assessments\n3. Maintain minimum attendance (80%)\n4. Complete the final project/exam\n\nCertificates are automatically generated and available in your dashboard within 5-7 business days after course completion."
            },
            support: {
                question: "How do I contact support?",
                answer: "You can reach our support team through:\n• Live Chat (available 24/7)\n• Email: support@artc.edu\n• Phone: +1 (555) 123-4567\n• Support Portal: Submit a ticket\n\nOur average response time is within 2 hours during business hours."
            }
        };
        
        // Simulate authentication
        function simulateAuth(role) {
            currentUserRole = role;
            
            switch(role) {
                case 'admin':
                    currentUserName = 'Admin User';
                    break;
                case 'professor':
                    currentUserName = 'Professor Smith';
                    break;
                case 'student':
                    currentUserName = 'Student John';
                    break;
                default:
                    currentUserName = 'Guest User';
            }
            
            updateUserDisplay();
            updateChatOptions();
        }
        
        function updateUserDisplay() {
            const userDiv = document.getElementById('currentUser');
            const roleColors = {
                admin: 'alert-danger',
                professor: 'alert-success',
                student: 'alert-info',
                guest: 'alert-secondary'
            };
            
            userDiv.className = `alert ${roleColors[currentUserRole]}`;
            userDiv.innerHTML = `
                <strong>${currentUserName}</strong><br>
                <small>Role: ${currentUserRole.charAt(0).toUpperCase() + currentUserRole.slice(1)}</small>
            `;
            
            // Update chat status
            const userStatus = document.getElementById('userStatus');
            if (userStatus) {
                userStatus.textContent = currentUserRole === 'guest' ? 'Guest User - Limited features' : `Logged in as ${currentUserName}`;
            }
        }
        
        function updateChatOptions() {
            // Hide all options
            document.getElementById('adminOptions').classList.add('d-none');
            document.getElementById('professorOptions').classList.add('d-none');
            document.getElementById('studentOptions').classList.add('d-none');
            document.getElementById('guestOptions').classList.add('d-none');
            document.getElementById('groupChatOptions').classList.add('d-none');
            
            // Show relevant options
            switch(currentUserRole) {
                case 'admin':
                    document.getElementById('adminOptions').classList.remove('d-none');
                    document.getElementById('groupChatOptions').classList.remove('d-none');
                    break;
                case 'professor':
                    document.getElementById('professorOptions').classList.remove('d-none');
                    break;
                case 'student':
                    document.getElementById('studentOptions').classList.remove('d-none');
                    break;
                default:
                    document.getElementById('guestOptions').classList.remove('d-none');
            }
        }
        
        // Include all the chat functionality from the enhanced system
        // ... (rest of the chat JavaScript from global-chat.blade.php)
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateUserDisplay();
            updateChatOptions();
        });
    </script>
</body>
</html>
