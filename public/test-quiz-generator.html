<!DOCTYPE html>
<html>
<head>
    <title>Quiz Generator Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2>Quiz Generator Test</h2>
    
    <div id="test-results" class="mt-4"></div>
    
    <form id="test-form" enctype="multipart/form-data" class="mt-4">
        <input type="hidden" name="_token" value="test-token">
        <div class="row">
            <div class="col-md-3">
                <label>Program ID</label>
                <input type="number" class="form-control" name="program_id" value="35" required>
            </div>
            <div class="col-md-3">
                <label>Module ID</label>
                <input type="number" class="form-control" name="module_id" value="56" required>
            </div>
            <div class="col-md-3">
                <label>Course ID</label>
                <input type="number" class="form-control" name="course_id" value="30" required>
            </div>
            <div class="col-md-3">
                <label>Content ID</label>
                <input type="number" class="form-control" name="content_id" value="27" required>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <label>Quiz Title</label>
                <input type="text" class="form-control" name="quiz_title" value="Test Quiz" required>
            </div>
            <div class="col-md-3">
                <label>Number of Questions</label>
                <input type="number" class="form-control" name="num_questions" value="5" min="5" max="50" required>
            </div>
            <div class="col-md-3">
                <label>Quiz Type</label>
                <select class="form-control" name="quiz_type" required>
                    <option value="multiple_choice">Multiple Choice</option>
                    <option value="true_false">True/False</option>
                </select>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <label>Upload Document</label>
                <input type="file" class="form-control" name="document" accept=".pdf,.txt" required>
            </div>
            <div class="col-md-6">
                <label>Instructions</label>
                <textarea class="form-control" name="instructions">Test instructions</textarea>
            </div>
        </div>
        <div class="mt-3">
            <button type="button" id="test-btn" class="btn btn-primary">Test Quiz Generation</button>
        </div>
    </form>
</div>

<script>
$(document).ready(function() {
    function logResult(message, type = 'info') {
        const alertClass = type === 'error' ? 'alert-danger' : type === 'success' ? 'alert-success' : 'alert-info';
        $('#test-results').append(`<div class="alert ${alertClass}">${message}</div>`);
    }
    
    // Test 1: Check if the quiz generator route is accessible
    $('#test-btn').click(function() {
        $('#test-results').empty();
        logResult('Starting quiz generator tests...');
        
        // Test authentication first
        $.get('/professor/quiz-generator')
            .done(function(data) {
                logResult('✓ Quiz generator page is accessible', 'success');
                testFormSubmission();
            })
            .fail(function(xhr) {
                logResult('✗ Quiz generator page not accessible: ' + xhr.status + ' ' + xhr.statusText, 'error');
                if (xhr.status === 401 || xhr.status === 403) {
                    logResult('Authentication required. Please login first.', 'error');
                }
            });
    });
    
    function testFormSubmission() {
        logResult('Testing form submission...');
        
        const formData = new FormData($('#test-form')[0]);
        
        // Create a simple text file for testing
        const blob = new Blob(['This is test content for quiz generation.'], { type: 'text/plain' });
        formData.set('document', blob, 'test.txt');
        
        $.ajax({
            url: '/professor/quiz-generator/generate',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                logResult('✓ Quiz generation successful!', 'success');
                logResult('Response: ' + JSON.stringify(response));
            },
            error: function(xhr) {
                logResult('✗ Quiz generation failed: ' + xhr.status + ' ' + xhr.statusText, 'error');
                if (xhr.responseText) {
                    logResult('Error details: ' + xhr.responseText, 'error');
                }
            }
        });
    }
});
</script>
</body>
</html>
